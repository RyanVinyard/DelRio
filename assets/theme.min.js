cartItem = JSON.parse(cartItem);
// console.log(cartItem);
// console.log(assetFolderUrl);

$((function () {
    $("html").removeClass("no-js").addClass("js");
    if (navigator.cookieEnabled)
            { $(".supports-cookies").removeClass("d-none");
            $(".supports-no-cookies").addClass("d-none") }
//             $('[data-toggle="tooltip"]').tooltip();
    if ("loading" in HTMLImageElement.prototype) { const images = document.querySelectorAll('img[loading="lazy"]'); images.forEach(img => { img.src = img.dataset.src }) }
    else { const script = document.createElement("script"); script.src = "https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js"; document.body.appendChild(script) }
     $(".product-image-gallery a").click((function (event)
            { event.preventDefault(); handleProductImageGallery($(this)) }));
     $('form[action="/cart/add"]').submit(
        (function (e) { 
            e.preventDefault(); 
            let quantity = parseInt($(this).find("input[type=number]").val());
            let addToCartBtn = $(this).find(".add-to-cart-btn");
            let cartIconEl = $(".d_none_mobile #cart-icon-count");
            let cartIconElMobile = $(".d_none_desktop #cart-icon-count");
            let toast = $("#cart-toast");
            addToCartBtn.prop("disabled", true).fadeTo(200, .5);
            addToCartBtn.find(".bs-spinner").removeClass("d-none");
            addToCartBtn.find("span").html(addToCartBtn.attr("data-loading-text"));
          console.log("$(this).serialize()", $(this).serialize());
            jQuery.post("/cart/add.js", $(this).serialize(), (function (data) {
                 console.log(data);
                let price = data.final_price;
                let image_src = Shopify.resizeImage(data.featured_image.url, "120x120");
                let image_alt = data.featured_image.alt;
                addToCartBtn.prop("disabled", false).fadeTo(200, 1);
                addToCartBtn.find(".bs-spinner").addClass("d-none");
                addToCartBtn.find("span").html(addToCartBtn.attr("data-add-to-cart-text"));
//                 $(".modal").modal("hide");
                cartIconEl.closest(".nav-item").addClass("active");
                cartIconEl.text(parseInt(cartIconEl.text()) + quantity);
                cartIconElMobile.closest(".nav-item").addClass("active");
                cartIconElMobile.text(parseInt(cartIconEl.text()) + quantity);
                /* 
                                cartItem.map(cartDetail => {
                                    console.log(cartDetail);
                                });
                 */
                updateCartHtml();
                // toast.toast("dispose").toast("show").find(".toast-body").html(`\n          <div class="d-flex align-items-center mb-0">\n            <img class="img-thumbnail mr-2" src="${image_src}" alt="${image_alt}" width="60" height="60" style="object-fit: cover">\n            <p class="mb-0">\n              <span class="d-block mb-0">${data.title}</span>\n              <span class="text-muted">${quantity} x ${Shopify.formatMoney(price,"")}</span>\n            </p>\n          </div>\n          <hr>\n          <a href="/cart" class="btn btn-primary btn-block btn-sm">${addToCartBtn.attr("data-view-cart-text")}</a>\n        `);
                // toast.focus()
            }), "json").fail((function (error) 
                              { console.log(error);
                               const response = error.responseJSON; 
                               addToCartBtn.prop("disabled", false).fadeTo(200, 1);
                               addToCartBtn.find(".bs-spinner").addClass("d-none");
                               addToCartBtn.find("span").html(addToCartBtn.attr("data-add-to-cart-text"));
                               toast.find(".toast-header strong").html(`${response.status} - ${response.message}`); 
                               toast.toast("dispose").toast("show").find(".toast-body").html(`\n <div>\n <p class="mb-0">\n  ${response.description}\n  </p>\n  </div>\n  `)
                              }
                             )
                            )
        }))
})); 

                function handleProductImageGallery(el) { el.closest(".product-image-gallery").find(".active").removeClass("active").removeAttr("aria-current").find(".img-thumbnail").removeClass("border-secondary"); el.addClass("active").attr("aria-current", "true"); el.children(".img-thumbnail").addClass("border-secondary"); el.closest(".product-images").find("img.product-featured-image").attr("src", el.attr("data-featured-img")).attr("alt", el.find("img").attr("alt")); el.closest(".product-images").find("a[data-toggle=modal]").attr("href", el.attr("data-modal-img")) }

function updateCartHtml() {
    let cartItemsHtml = '';
    jQuery.ajax({
        type: 'GET',
        url: '/cart.js',
        cache: false,
        dataType: 'json',
        success: function (cart) {
            // console.log(cart.items);
            let cartIconEl = $(".d_none_mobile #cart-icon-count");
            let cartIconElMobile = $(".d_none_desktop #cart-icon-count");
            cartIconEl.closest(".nav-item").addClass("active");
            cartIconEl.text(cart.item_count);
            cartIconElMobile.closest(".nav-item").addClass("active");
            cartIconElMobile.text(cart.item_count);


            if (cart.items.length == 1) {
                cartItemsHtml = '\
                <div id="hidesectiononclick23">\
                <div id="make_padding">\
                    <div class="header_right">\
                    <span class="Cart_it">CART</span> <span class="cart_item cart_item_count"></span>\
                    <a href="javascript: void(0);" class="closebtn" id="closebutton"><i class="fa fa-times"></i></a>\
                    </div>\
                    <div class="cart_right">';
            }

            cartItemsHtml += cart.items.map((cartDetail, index) => {
                ++index;
              console.log(cartDetail);
                var imageSrc = cartDetail.image === null ? assetFolderUrl : Shopify.resizeImage(cartDetail.image, '80x80');
              var cartpropertysubs;
              // Modified by Bloom on Feb 16, 2022
  			  // if (cartDetail.properties.Subscription != '') {
              if (!!(cartDetail.properties||{}).Subscription) {
                cartpropertysubs = 'Subscription : '+cartDetail.properties.Subscription;
              }
              else {
                cartpropertysubs = '';
              }
              
              	var sellingPlanSubscription = '';  
              if("selling_plan_allocation" in cartDetail){
                sellingPlanSubscription = '<div class="ml-0 cart_item">'+cartDetail.selling_plan_allocation.selling_plan.name+'</div>';
              	}
              
              	return '<div class=row>\
                <div class="col-lg-6 col-md-6 col-sm-6 col-6">\
                <div class="right_flex">\
                    <img src="'+ imageSrc + '" alt="">\
                    <div>\
                    <span class="cart_item">'+ cartDetail.title + '</span>\
                <div class="ml-0 cart_item">\
                  '+cartpropertysubs+'\
                </div>\
                <div class="ml-0 cart_item">\
					'+sellingPlanSubscription+'\
                </div>\
					<a data-line-item="'+ index + '" href="/cart/change.js?line=' + index + '&amp;quantity=0" data-product-id="' + cartDetail.variant_id + '" class="cart_remove cart_remove_item">Remove</a>\
                    </div>\
                </div >\
                </div >\
            <div class="col-lg-6 col-md-6 col-sm-6 col-6 d-flex justify-content-center align-items-center">\
                    <form class="value_btn">\
                    <div class="val_btn">\
                        <div class="value-button" id="decrease" data-product-id="'+ cartDetail.variant_id + '" onclick="decreaseValue(this)" value="Decrease Value">-</div>\
                        <input data-product-id="'+ cartDetail.variant_id + '" type="number" id="number" value="' + cartDetail.quantity + '">\
                        <div class="value-button" id="increase" data-product-id="'+ cartDetail.variant_id + '" onclick="increaseValue(this)" value="Increase Value">+</div>\
                    </div>\
                    </form>\
                    <span class="cart_ruppee">'+ Shopify.formatMoney(cartDetail.line_price) + '</span>\
                </div>\
            </div>';
            }).join('');
            if (cart.items.length == 1) {
                cartItemsHtml += '</div>\
                </div>\
                <div id="newtexthaus21" class="row cart-view__footer-layout cart-view__gift-note b-top-french gutter-px-xs-2 oys">\
                <div class="col col-xs-full">\
                  <div class="cart-view__block -py-20 bps-py-30">\
                    <div class="hot_summer_months">\
                      <p class="warning_moths_SUMMER">\
                          For the hot summer months we recommend shipping next day air. All ground shippments will be held until weather permits.\
                      </p>\
                    </div>\
                    <div class="justoify_spac_997">\
                      <div class="d-flex">\
                        <svg width="21" height="23" viewBox="0 0 21 23" fill="none" xmlns="http://www.w3.org/2000/svg" class="zera_pl -mr-10">\
                          <path d="M20.3 5.47001H16C16.457 5.07323 16.7891 4.55247 16.9562 3.97079C17.1233 3.38912 17.1182 2.77148 16.9415 2.19265C16.7648 1.61383 16.424 1.09865 15.9605 0.709491C15.497 0.320336 14.9307 0.0738964 14.33 1.25133e-05C13.9206 -0.0583365 13.5036 -0.0344413 13.1036 0.0702997C12.7035 0.175041 12.3283 0.358524 12 0.610013C11.21 1.19001 10.56 2.82001 10.16 4.10001C9.75 2.82001 9.1 1.19001 8.31 0.610013C7.63562 0.121302 6.796 -0.0823824 5.97265 0.0429918C5.14929 0.168366 4.40835 0.612726 3.91 1.28001C3.41754 1.95372 3.21254 2.7953 3.34 3.62001C3.4476 4.33436 3.80129 4.9887 4.34 5.47001H0V9.87001H1.5V22.12H18.8V9.87001H20.3V5.47001ZM12.58 1.47001C12.8058 1.30064 13.063 1.17782 13.3367 1.10872C13.6103 1.03961 13.895 1.02558 14.1741 1.06745C14.4533 1.10932 14.7213 1.20625 14.9626 1.35261C15.204 1.49897 15.4138 1.69184 15.58 1.92001C15.9169 2.36209 16.0676 2.91834 16 3.47001C15.9618 3.74939 15.8678 4.01822 15.7235 4.26047C15.5791 4.50272 15.3875 4.71342 15.16 4.88001C14.5 5.36001 12.37 5.45001 10.85 5.38001C11.21 3.91001 11.92 1.90001 12.58 1.42001V1.47001ZM4.72 1.93001C4.91196 1.64694 5.16955 1.41452 5.4708 1.25258C5.77205 1.09064 6.10801 1.00398 6.45 1.00001C6.90722 1.00141 7.3521 1.14853 7.72 1.42001C8.38 1.90001 9.09 3.91001 9.49 5.42001C7.97 5.48001 5.83 5.42001 5.18 4.92001C4.94982 4.7552 4.75571 4.54514 4.60955 4.30269C4.4634 4.06024 4.36827 3.79051 4.33 3.51001C4.27962 3.2261 4.28824 2.93485 4.35534 2.65442C4.42244 2.37399 4.54657 2.11037 4.72 1.88001V1.93001ZM1 8.87001V6.47001H9.65V8.87001H1ZM2.5 9.87001H9.65V21.12H2.5V9.87001ZM17.8 21.12H10.65V9.87001H17.8V21.12ZM19.3 8.87001H10.65V6.47001H19.3V8.87001Z" fill="#191919">\
                          </path>\
                        </svg>\
                        <span class="align-center Gifting_Del_88">Gifting Del Rio?</span>\
                      </div>  \
                      <span id="movetoTextarea" class="button-text pointer_0008 x-small -ml-auto button-text--underline">View Options</span>\
                    </div>\
                    <div class="peek-wrap" style="display: block;">\
                      <p class="note-peek gta-standard-italic text-faded-black small_0009 -d-block bps-d-none -mb-0 -mt-15" id="workhard">\
                        Include a free note placed in the box.\
                      </p>\
                    </div>\
                  </div>\
                </div>\
              </div>\
                <div class="gra_footer">\
                <div class="footer_right" id="footer_right_menu">\
                    <div class="d-flex justify-content-between">\
                    <a href="/cart" class="footer_right_menu_p3"><button class="onto_cart shop_continue Continue-Shopping cart-total-value"></button></a>\
                    </div>\
                    <p class="please_ship_address_21_plus_pop_cart">Please ship to an address where an adult (21+) will be available to sign for the package.</p>\
                </div>\
                </div>\
                </div>\
                <div id="displayOnclickatoptions" class="row cart-view__footer-layout cart-view__gift-note b-top-french gutter-px-xs-2 oys">\
                <div class="col col-xs-full">\
                  <div class="mini-cart__header mini-cart__header--gift-panel-open gutter-px-xs-1 gutter-px-lg-2 -pt-20">\
                    <div class="mini-cart__header-inner mini-cart__header-inner--gift-panel-open -py-30">\
                      <span id="movebacktocartdisplayto" class="pointer_0008 base-text_0009 -mr-auto">\
                        <svg width="11" height="16" viewBox="0 0 11 16" fill="none" xmlns="http://www.w3.org/2000/svg" class="-mr-10 note-arrow"><path d="M8.00818 1.70833e-06L10.2847 2.27649L4.56923 7.99193L10.2847 13.7235L8.00818 16L0.000107512 7.99193L8.00818 1.70833e-06Z" fill="#0C0C0C"></path></svg>\
                        Back to Cart\
                      </span>\
                    </div>\
                  </div>\
                  <div class="cart-view__block -py-20 bps-py-30">\
                    <div class="peek-wrap" style="display: none;">\
                      <p class="note-peek--clear gta-standard text-faded-black small_0009 -mb-0 -mt-15">Include a free note. Limited-edition gift boxes no longer available.</p>\
                    </div>\
                    <div class="cart-view__messaging oh  -pb-20 bps-pb-30 b-bottom-french" style="display: block;">\
                      <h2 class="note-header -mt-0 -mb-30">Add a complimentary note</h2>\
                      <p class="small_0009 -no-mt -mb-30">We’ll include a personalized note with your order. No emojis, please! (Gift notes are unavailable for same-day delivery orders.)️</p>\
                      <div>\
						<textarea class="custom-textarea -py-5 -px-10 message222" name="attributes[Gift Message Custom]" id="CartSpecialInstructions" maxlength="100" placeholder="Type your message here...">'+ cart.attributes['Gift Message Custom'] +'</textarea>\
                        <div class="flex -my-20">\
                          <span class="remaningtext"><span id="counter">100 </span> characters remaining</span>\
                          <span class="button-text_tocleartexarea button-text--disabled" id="clearalltexarea"> Clear</span>\
                        </div>\
                        <div class="save-note-wrap">\
                          <button class="-mt-sm btn btn_textareasection btn--full -d-table -mt-10 -mx-auto is-disabled is-gray" id="disablemessage21" disabled="">Saved Message</button>\
                        </div>\
                      </div>\
                    </div>\
                  </div>\
                </div>\
              </div>';
            }
            if (cart.item_count <= 0) {
                cartItemsHtml = '<div id="make_padding" class="make_left_right_padding_for_alls_hmepg">\
                                <div class="header_right make_padding_classhomepage_sm_333">\
                                    <a href="javascript: void(0);" class="closebtn" id="closebutton"><i class="fa fa-times"></i></a>\
                                <div class="empty_cart_homepage_css_228_hh text-center">\
                                    <svg xmlns="http://www.w3.org/2000/svg" width="36" height="44" viewBox="0 0 36 44">\
                                        <g fill="none" fill-rule="evenodd" opacity=".1">\
                                            <g stroke="#171F15" stroke-width="4">\
                                                <g>\
                                                    <g>\
                                                        <path d="M10 22V8c0-4.418 3.582-8 8-8s8 3.582 8 8v14h0" transform="translate(-1158 -80) translate(952 82) translate(206)"/>\
                                                        <path d="M34 10v30H2V10h32z" transform="translate(-1158 -80) translate(952 82) translate(206)"/>\
                                                    </g>\
                                                </g>\
                                            </g>\
                                        </g>\
                                    </svg>\
                                    <h1 class="Your-bag-is-empty_home_ssm">Your bag is empty</h1>\
                                    <p class="Log-in-to-see-items_789">Shop to add products to your cart</p>\
                                    <a href="/collections/all" id="close_button_empty_cart_home"><p class="LEARN-MORE_homepage_789_empty_cart">SHOP ALL</p></a>\
                                </div>\
                            </div>';
                jQuery('#mySideNav').html(cartItemsHtml);
                return false;
            }
            if (cart.items.length == 1) {
                jQuery('#mySideNav').html(cartItemsHtml);
            }
            else {
                jQuery('.cart_right').html(cartItemsHtml);
            }
            jQuery('.cart_item_count').html('(' + cart.item_count + ' item)');
            jQuery('.cart-total-value').html('CHECKOUT - ' + Shopify.formatMoney(cart.total_price));
            jQuery('.cart_open_right')[0].click();
            // whatever you want to do with the cart obj
        }

    });

}

jQuery(document).on('click', '.cart_remove_item', function (event) {
    event.preventDefault();
    var ajaxURL = this.href;
    console.log(ajaxURL, jQuery(this).attr('href'));
    jQuery.post(jQuery(this).attr('href'), (function (data) {
        updateCartHtml();
    }), 'json');

});

jQuery(document).on('keyup change', '#number', function () {
    console.log(this.value, jQuery(this).attr('data-product-id'));
  console.log('cheema cart cheema');
  if(jQuery(this).attr('data-product-id') > 0)
    cartItemQuantityChange(jQuery(this).attr('data-product-id'), this.value);
});

function cartItemQuantityChange(productId, quantity) {
    jQuery.post(
        '/cart/change.js',
        {
            quantity: quantity,
            id: productId
        },
        (function (data) {
            updateCartHtml();
        }), 'json');
}

/*checkout popup adult*/

function checkoutpopup(){
  //console.log('checkout_button');
    var url = localStorage.getItem("agecheck");
    if(url){
       jQuery(location).attr('href', 'https://delriovineyards.com/apps/wine-club/checkout');	
    }
    else{
       jQuery("#checkoutpopup").modal('show');
    }
};
jQuery( window ).on('load',function() {
    
  jQuery( "#checkoutyes" ).click(function() {
  localStorage.setItem("agecheck","yes");
  // jQuery("#checkout_close").click();
   jQuery(location).attr('href', 'https://delriovineyards.com/apps/wine-club/checkout'); 
 });
  jQuery( "#checkoutno" ).click(function() {
    jQuery(location).attr('href', 'http://centurycouncil.org/');
  });
});

/*popup video*/
 jQuery( document ).ready(function() {
  jQuery( "#video_button" ).click(function() {
    jQuery('#videopopup').modal('show')
	});  
});
// for mobile screen home page section 8
 jQuery( document ).ready(function() {
  jQuery( "#video_button_66" ).click(function() {
    jQuery('#videopopup_990').modal('show')
	});  
});


/*stop body to scroll*/

 jQuery( document ).ready(function() {
    jQuery( "#menubtn" ).click(function() {      
    jQuery('body').addClass('body-overflow');
	});
   
/*click on body to close cart*/
   jQuery('#site-main').on('click',function(e){
     console.log(this,jQuery(e.target).attr('class'));
     if(jQuery(e.target).hasClass('shop_joliee') || jQuery(e.target).hasClass('add-to-cart-custom') ){
     	return;
     }
     
      if(jQuery( "body" ).hasClass( "body-overflow" )){
     jQuery('#mySideNav').css({'width':'0', 'margin-right':'-800px','visibility': 'hidden'});
        jQuery("#site-main").removeClass("blur"); 
        jQuery('body').removeClass('body-overflow');
        jQuery("#shopify-section-footer").removeClass("blur");
  		 }
        });
   jQuery('#shopify-section-footer').on('click',function(e){
     
        });
   
/*blur effect*/
   jQuery( ".add-to-cart-blur" ).on('click',function(e) {
   jQuery('body').addClass('body-overflow');
   jQuery("#site-main").addClass("blur");
    //jQuery('body').addClass('body-overflow');
    console.log('blur added');
	}); 

  });

/*button drop down rio page*/

 jQuery( document ).ready(function() {
   
   jQuery(".box").click(function(){
     jQuery(this).css({'display': 'none'});
     jQuery(this).next().toggle();
//      $(this).val( $(this).val() == 'Close' ? 'Choose options' : 'Close' );
   });
  });

 jQuery('.product-url').on('click',function(e){
	e.preventDefault();
	var productURL = jQuery(this).attr('data-product-url');
	window.location.href = productURL;
	e.stopPropagation();
});				

  jQuery('.add-to-cart-custom').on('click', function(e){
    e.preventDefault();   
    var productID = jQuery(this).attr('data-product-id');
    jQuery('#product_form_'+productID).find('button').click();
	e.stopPropagation();
  });

jQuery( document ).ready(function() {
    jQuery('body').on('click', '#movetoTextarea', function() {
    // jQuery("#movetoTextarea").on('click',function() {
	jQuery("#displayOnclickatoptions").css("display","block");
	jQuery("#hidesectiononclick23").css("display","none");
  });
    jQuery('body').one('click', '#movetoTextarea', function() {
    	jQuery("#CartSpecialInstructions").val('');
  }); 
});
    var messageEle = document.getElementById('CartSpecialInstructions');
    var counterEle = document.getElementById('counter');
       jQuery('body').on('input', '#CartSpecialInstructions' , function(e) {    
    // messageEle.addEventListener('input', function(e) {
        var target = e.target;
        var currentLength = target.value.length;
        var currnumtextarea = 100 - `${currentLength}`;
        document.getElementById('counter').innerHTML = currnumtextarea ;
        document.getElementById("disablemessage21").innerHTML = "Save Message";
         if ( currentLength > 0 ) {
            jQuery("#clearalltexarea").removeClass("button-text--disabled");
            jQuery("#clearalltexarea").addClass("clicktoemptytextarea");
            jQuery("#disablemessage21").prop('disabled', false);
            jQuery("#disablemessage21").removeClass("is-gray");
            jQuery('body').on('click', '.clicktoemptytextarea', function() {
            // jQuery(".clicktoemptytextarea").on('click',function() {  
            jQuery("#CartSpecialInstructions").val("");
            jQuery("#counter").html("100");
            jQuery("#clearalltexarea").addClass("button-text--disabled");    
            jQuery("#disablemessage21").addClass("is-gray");
            jQuery("#disablemessage21").prop( "disabled", true );
            jQuery("#clearalltexarea").removeClass("clicktoemptytextarea");
            var newtextchangeafterclear = "Include a free note placed in the box.";
            var newtxtafterclear = document.getElementById("workhard").innerHTML = newtextchangeafterclear;
            document.getElementById("movetoTextarea").innerHTML = "View Options";
            document.getElementById("disablemessage21").innerHTML = "Save Message";
          });
          jQuery('body').on('click', '.btn:not(:disabled):not(.disabled)', function() {
        //   jQuery(".btn:not(:disabled):not(.disabled)").on('click',function(){
            var changetxt1 = jQuery("#CartSpecialInstructions").val();
            var newtxt456 = document.getElementById("workhard").innerHTML = changetxt1;
            document.getElementById("movetoTextarea").innerHTML = "Edit Options";
            jQuery("#disablemessage21").addClass("is-gray");
            jQuery("#disablemessage21").prop( "disabled", true );
            document.getElementById("disablemessage21").innerHTML = "Saved Message";
          });

          }
        else if ( currentLength == 0 ) {
            jQuery("#clearalltexarea").addClass("button-text--disabled");
            jQuery("#disablemessage21").addClass("is-gray");
            jQuery("#disablemessage21").prop( "disabled", true );
            jQuery("#clearalltexarea").removeClass("clicktoemptytextarea");
   		}
});
     
jQuery( document ).ready(function() {
    jQuery('body').on('click', '#movebacktocartdisplayto', function() {
    // jQuery("#movebacktocartdisplayto").on('click',function() {
	jQuery("#displayOnclickatoptions").css("display","none");   
	jQuery("#hidesectiononclick23").css("display","block");
  });
});

jQuery( document ).ready(function() {
    jQuery('body').on('click', '#disablemessage21', function() {
	jQuery("#displayOnclickatoptions").css("display","none");
	jQuery("#hidesectiononclick23").css("display","block");
  });
});

                    